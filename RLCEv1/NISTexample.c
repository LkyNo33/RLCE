/* RLCE example.c */
#include "rlce.h"
#include "api.h"

int main (int argc, char *argv[]) {
  int ret;
  unsigned char randomness[CRYPTO_RANDOMBYTES];
  unsigned char rand[]={0xae,0x7e,0xbe,0x06,0x29,0x71,0xf5,0xeb,0x32,0xe5,0xb2,0x14,0x44,0x75,0x07,0x85,
			0xde,0x81,0x65,0x95,0xad,0x2c,0xbe,0x80,0xa2,0x09,0xc8,0xf8,0xab,0x04,0xb5,0x46,
			0x67,0x56,0x27,0xef,0x86,0xaa,0x2e,0x7d,0x70,0x29,0xa1,0x52,0xb8,0x00,0x07,0x2f};
  memcpy(randomness, rand, CRYPTO_RANDOMBYTES);
  unsigned char pk[CRYPTO_PUBLICKEYBYTES];
  unsigned char sk[CRYPTO_SECRETKEYBYTES];
  ret=crypto_kem_keygenerate_KAT(pk,sk,randomness);
  //ret=crypto_kem_keygenerate(pk,sk);
  if (ret<0) return ret;

  unsigned char sslong[]={0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x10,0x11,0x12,0x13,0x14,0x15,0x16,
			0x17,0x18,0x19,0x20,0x21,0x22,0x23,0x24,0x25,0x26,0x27,0x28,0x29,0x30,0x31,0x32,
			0x33,0x34,0x35,0x36,0x37,0x38,0x39,0x40,0x41,0x42,0x43,0x44,0x45,0x46,0x47,0x48,
			0x49,0x50,0x52,0x52,0x53,0x54,0x55,0x56,0x57,0x58,0x59,0x60,0x61,0x62,0x63,0x64};
  unsigned char ss[CRYPTO_BYTES];
  memcpy(ss, sslong, CRYPTO_BYTES);
  unsigned char ct[CRYPTO_CIPHERTEXTBYTES];
  ret=crypto_kem_encapsulate_KAT(ct,ss,(const unsigned char *)pk,(const unsigned char *)randomness);
  //ret=crypto_kem_encapsulate(ct,ss,(const unsigned char *)pk);
  if (ret<0)  printf("error encapsulate\n");

  memset(ss, 0, CRYPTO_BYTES);
  ret=crypto_kem_decapsulate(ss, (const unsigned char *)ct, (const unsigned char *)sk);
  if(ret<0) printf("error decapsulate\n");
  int i, correct=1;
  for (i=0; i<CRYPTO_BYTES; i++) {
    if (ss[i]!=sslong[i]) correct =0;
  }
  if (correct ==0) {
    printf("WRONG\n");
  } else {
    for (i=0; i<CRYPTO_BYTES; i++) printf("%02x,", ss[i]);
    printf("\n");
    //printf("TEST successful\n");
  }
  exit(0);
}

